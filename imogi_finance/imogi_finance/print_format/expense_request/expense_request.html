<style>
  :root {
    --primary: #1a1a1a;
    --secondary: #525252;
    --border: #e5e5e5;
    --bg-light: #fafafa;
    --text: #404040;
    --text-light: #737373;
  }
  
  * {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    box-sizing: border-box;
  }
  
  body { font-size: 10px; color: var(--text); margin: 0; padding: 0; }
  
  /* A4 Page Setup */
  .container { 
    width: 210mm;
    min-height: 297mm;
    margin: 0 auto; 
    padding: 15mm 20mm;
    background: white;
  }
  
  /* Header */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--primary);
    margin-bottom: 12px;
  }
  
  .header h1 {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    color: var(--primary);
  }
  
  .header .doc-id {
    font-size: 11px;
    color: var(--text-light);
  }
  
  .badge {
    display: inline-block;
    padding: 4px 12px;
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 4px;
    background: var(--bg-light);
    color: var(--secondary);
    border: 1px solid var(--border);
  }
  
  .badge-approved { background: var(--primary); color: white; border-color: var(--primary); }
  .badge-pending { background: #fef3c7; color: #92400e; border-color: #fde68a; }
  .badge-rejected { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
  
  /* Grid */
  .grid { display: grid; gap: 12px; margin-bottom: 12px; }
  .grid-2 { grid-template-columns: repeat(2, 1fr); }
  .grid-4 { grid-template-columns: repeat(4, 1fr); }
  
  /* Card */
  .card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 10px 12px;
  }
  
  .card-title {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-light);
    margin: 0 0 8px 0;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border);
  }
  
  .row {
    display: flex;
    justify-content: space-between;
    padding: 3px 0;
    font-size: 10px;
  }
  
  .row-label { color: var(--text-light); }
  .row-value { font-weight: 500; color: var(--primary); text-align: right; }
  
  /* Table */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 9px;
    margin-bottom: 12px;
  }
  
  thead { background: var(--primary); color: white; }
  
  th {
    padding: 6px 10px;
    text-align: left;
    font-weight: 600;
    font-size: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  th.right { text-align: right; }
  
  td {
    padding: 6px 10px;
    border-bottom: 1px solid var(--border);
    color: var(--text);
  }
  
  td.right { text-align: right; font-weight: 500; }
  
  tr:nth-child(even) { background: var(--bg-light); }
  
  tfoot { background: var(--bg-light); border-top: 2px solid var(--primary); }
  tfoot th { color: var(--primary); }
  
  /* Notes */
  .notes {
    background: var(--bg-light);
    border-left: 3px solid var(--secondary);
    padding: 8px 12px;
    margin-bottom: 12px;
  }
  
  .notes-title {
    font-size: 8px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-light);
    margin-bottom: 3px;
  }
  
  .notes-content {
    font-size: 9px;
    color: var(--text);
    line-height: 1.4;
  }
  
  /* Signature Section */
  .signature-section {
    margin-top: 30px;
    page-break-inside: avoid;
  }
  
  .signature-section-title {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--primary);
    margin-bottom: 15px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border);
  }
  
  .signature-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
  }
  
  .signature-box {
    text-align: center;
    padding: 10px;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: white;
  }
  
  .signature-role {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-light);
    margin-bottom: 8px;
  }
  
  .signature-line {
    height: 50px;
    border-bottom: 1px solid var(--primary);
    margin: 0 10px 8px 10px;
  }
  
  .signature-name {
    font-size: 10px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 2px;
    min-height: 14px;
  }
  
  .signature-date {
    font-size: 8px;
    color: var(--text-light);
    min-height: 12px;
  }
  
  .signature-status {
    font-size: 7px;
    font-weight: 600;
    text-transform: uppercase;
    margin-top: 4px;
    padding: 2px 6px;
    border-radius: 3px;
    display: inline-block;
  }
  
  .signature-status.approved {
    background: #dcfce7;
    color: #166534;
  }
  
  .signature-status.pending {
    background: #fef3c7;
    color: #92400e;
  }
  
  .signature-status.rejected {
    background: #fee2e2;
    color: #991b1b;
  }
  
  /* Print */
  @media print {
    @page { 
      size: A4;
      margin: 10mm; 
    }
    
    body { 
      margin: 0; 
      padding: 0; 
    }
    
    .container {
      width: 100%;
      min-height: auto;
      padding: 5mm;
    }
    
    thead { background: var(--primary) !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .badge-approved { background: var(--primary) !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .signature-status.approved { background: #dcfce7 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .signature-status.pending { background: #fef3c7 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .signature-status.rejected { background: #fee2e2 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    
    .signature-section {
      page-break-inside: avoid;
    }
  }
</style>

<div class="container">
  <div class="header">
    <div>
      <h1>{{ _("Expense Request") }}</h1>
      <div class="doc-id">{{ doc.name }}</div>
    </div>
    {% set status_class = {
      'Approved': 'approved',
      'Pending Review': 'pending',
      'Rejected': 'rejected'
    }.get(doc.status, '') %}
    <span class="badge badge-{{ status_class }}">{{ doc.status or doc.workflow_state or 'Draft' }}</span>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">{{ _("Request Details") }}</div>
      <div class="row">
        <span class="row-label">{{ _("Date") }}</span>
        <span class="row-value">{{ frappe.utils.formatdate(doc.request_date) }}</span>
      </div>
      <div class="row">
        <span class="row-label">{{ _("Type") }}</span>
        <span class="row-value">{{ doc.request_type }}</span>
      </div>
      <div class="row">
        <span class="row-label">{{ _("Cost Center") }}</span>
        <span class="row-value">{{ doc.cost_center }}</span>
      </div>
      {% if doc.project %}
      <div class="row">
        <span class="row-label">{{ _("Project") }}</span>
        <span class="row-value">{{ doc.project }}</span>
      </div>
      {% endif %}
    </div>

    <div class="card">
      <div class="card-title">{{ _("Supplier") }}</div>
      <div class="row">
        <span class="row-label">{{ _("Name") }}</span>
        <span class="row-value">{{ doc.supplier }}</span>
      </div>
      {% if doc.supplier_invoice_no %}
      <div class="row">
        <span class="row-label">{{ _("Invoice No") }}</span>
        <span class="row-value">{{ doc.supplier_invoice_no }}</span>
      </div>
      {% endif %}
      {% if doc.supplier_invoice_date %}
      <div class="row">
        <span class="row-label">{{ _("Invoice Date") }}</span>
        <span class="row-value">{{ frappe.utils.formatdate(doc.supplier_invoice_date) }}</span>
      </div>
      {% endif %}
      <div class="row">
        <span class="row-label">{{ _("Currency") }}</span>
        <span class="row-value">{{ doc.currency }}</span>
      </div>
    </div>
  </div>

  {% if doc.description %}
  <div class="notes">
    <div class="notes-title">{{ _("Notes") }}</div>
    <div class="notes-content">{{ doc.description }}</div>
  </div>
  {% endif %}

  <table>
    <thead>
      <tr>
        <th style="width: 40%">{{ _("Account") }}</th>
        <th style="width: 30%">{{ _("Description") }}</th>
        <th class="right" style="width: 15%">{{ _("Amount") }}</th>
        <th class="right" style="width: 15%">{{ _("PPh Base") }}</th>
      </tr>
    </thead>
    <tbody>
      {% for row in doc.items %}
      <tr>
        <td>{{ row.expense_account }}</td>
        <td>{{ row.description or '-' }}</td>
        <td class="right">{{ frappe.utils.fmt_money(row.amount, currency=doc.currency) }}</td>
        <td class="right">{{ frappe.utils.fmt_money(row.pph_base_amount or 0, currency=doc.currency) if row.is_pph_applicable else '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th colspan="2" class="right">{{ _("Subtotal") }}</th>
        <th colspan="2" class="right">{{ frappe.utils.fmt_money(doc.amount, currency=doc.currency) }}</th>
      </tr>
    </tfoot>
  </table>

  <div class="grid grid-2">
    <div class="card">
      <div class="card-title">{{ _("Tax Summary") }}</div>
      <div class="row">
        <span class="row-label">{{ _("PPN") }}</span>
        <span class="row-value">{{ frappe.utils.fmt_money(doc.total_ppn or 0, currency=doc.currency) }}</span>
      </div>
      <div class="row">
        <span class="row-label">{{ _("PPh") }}</span>
        <span class="row-value" style="color: #dc2626;">-{{ frappe.utils.fmt_money(doc.total_pph or 0, currency=doc.currency) }}</span>
      </div>
      <div class="row" style="border-top: 1px solid var(--border); padding-top: 8px; margin-top: 4px;">
        <span class="row-label" style="font-weight: 600;">{{ _("Total") }}</span>
        <span class="row-value" style="font-size: 12px;">{{ frappe.utils.fmt_money(doc.total_amount or 0, currency=doc.currency) }}</span>
      </div>
    </div>

    <div class="card">
      <div class="card-title">{{ _("Payment Info") }}</div>
      <div class="row">
        <span class="row-label">{{ _("Payment Status") }}</span>
        <span class="row-value">{{ doc.payment_status or 'Unpaid' }}</span>
      </div>
      {% if doc.payment_entry %}
      <div class="row">
        <span class="row-label">{{ _("Payment Entry") }}</span>
        <span class="row-value">{{ doc.payment_entry }}</span>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Signature Section -->
  <div class="signature-section">
    <div class="signature-section-title">{{ _("Signatures") }}</div>
    <div class="signature-grid">
      <!-- Created By -->
      <div class="signature-box">
        <div class="signature-role">{{ _("Created By") }}</div>
        <div class="signature-line"></div>
        <div class="signature-name">{{ doc.owner | replace("@", " ") if doc.owner else '' }}</div>
        <div class="signature-date">{{ frappe.utils.formatdate(doc.creation) if doc.creation else '' }}</div>
      </div>
      
      <!-- Level 1 Approval -->
      <div class="signature-box">
        <div class="signature-role">{{ _("Approved By (L1)") }}</div>
        <div class="signature-line"></div>
        <div class="signature-name">{{ doc.level_1_user or '' }}</div>
        <div class="signature-date">{{ frappe.utils.formatdate(doc.level_1_approved_on) if doc.level_1_approved_on else '' }}</div>
        {% if doc.level_1_approved_on %}
        <span class="signature-status approved">{{ _("Approved") }}</span>
        {% elif doc.level_1_user %}
        <span class="signature-status pending">{{ _("Pending") }}</span>
        {% endif %}
      </div>
      
      <!-- Level 2 Approval -->
      <div class="signature-box">
        <div class="signature-role">{{ _("Approved By (L2)") }}</div>
        <div class="signature-line"></div>
        <div class="signature-name">{{ doc.level_2_user or '' }}</div>
        <div class="signature-date">{{ frappe.utils.formatdate(doc.level_2_approved_on) if doc.level_2_approved_on else '' }}</div>
        {% if doc.level_2_approved_on %}
        <span class="signature-status approved">{{ _("Approved") }}</span>
        {% elif doc.level_2_user %}
        <span class="signature-status pending">{{ _("Pending") }}</span>
        {% endif %}
      </div>
      
      <!-- Level 3 Approval -->
      <div class="signature-box">
        <div class="signature-role">{{ _("Approved By (L3)") }}</div>
        <div class="signature-line"></div>
        <div class="signature-name">{{ doc.level_3_user or '' }}</div>
        <div class="signature-date">{{ frappe.utils.formatdate(doc.level_3_approved_on) if doc.level_3_approved_on else '' }}</div>
        {% if doc.level_3_approved_on %}
        <span class="signature-status approved">{{ _("Approved") }}</span>
        {% elif doc.level_3_user %}
        <span class="signature-status pending">{{ _("Pending") }}</span>
        {% endif %}
      </div>
    </div>
  </div>
</div>